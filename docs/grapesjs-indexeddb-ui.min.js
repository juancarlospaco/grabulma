!function(e,t){'object'==typeof exports&&'object'==typeof module?module.exports=t():'function'==typeof define&&define.amd?define([],t):'object'==typeof exports?exports["grapesjs-indexeddb-ui"]=t():e["grapesjs-indexeddb-ui"]=t()}(window,(function(){return function(e){var t={};function n(r){if(t[r])return t[r].exports;var o=t[r]={i:r,l:!1,exports:{}};return e[r].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,r){n.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:r})},n.r=function(e){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(e,'__esModule',{value:!0})},n.t=function(e,t){if(1&t&&(e=n(e)),8&t)return e;if(4&t&&'object'==typeof e&&e&&e.__esModule)return e;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,'default',{enumerable:!0,value:e}),2&t&&'string'!=typeof e)for(var o in e)n.d(r,o,function(t){return e[t]}.bind(null,o));return r},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,'a',t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=2)}([function(e,t,n){var r=n(3);e.exports=function(e,t){if(null==e)return{};var n,o,s=r(e,t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(o=0;o<a.length;o++)n=a[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(s[n]=e[n])}return s}},function(e,t){e.exports=function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}},function(e,t,n){"use strict";n.r(t);var r=n(0),o=n.n(r),s=n(1),a=n.n(s);function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a()(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}t.default=function(e){var t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=c(c({},{dbName:'gjs',objectStoreName:'templates',indexeddbVersion:4,addOnUpgrade:0}),n),s="Default",a="",i="Blank",d=!1,l=document.querySelectorAll.bind(document),u=e.Commands,p=e.Modal,f=e.StorageManager,g='indexeddb',m=r.objectStoreName,v=function(){return f.getConfig().id||'gjs-'},b=function(){return t},j=function(e){if(t)e(t);else{var n=(window.indexedDB||window.mozIndexedDB||window.webkitIndexedDB||window.msIndexedDB).open(r.dbName,r.indexeddbVersion),o=function(){return f.onError(g,n.errorCode)};n.onerror=o,n.onsuccess=function(){(t=n.result).onerror=o,e(t)},n.onupgradeneeded=function(e){e.currentTarget.result.createObjectStore(m,{keyPath:'id'}),r.addOnUpgrade&&r.addOnUpgrade.forEach((function(e){O((function(t){t.put(c({id:e.id,template:e.template},e))}))}))}}},y=function(){return t.transaction([m],'readwrite').objectStore(m)},O=function(e){t?e(y()):j((function(t){return e(y())}))};f.add(g,{getDb:b,getObjectStore:y,load:function(e,t,n){O((function(e){var r=e.get(s);r.onerror=n,r.onsuccess=function(){var e=r.result||{},n=(e.id,e.template,o()(e,["id","template"]));t(n)}}))},loadAll:function(e,t){O((function(n){var r=n.getAll();r.onerror=t,r.onsuccess=function(){e(r.result)}}))},store:function(e,t,n){O((function(r){var o=r.put(c({id:s,template:d},e));o.onerror=n,o.onsuccess=t}))},delete:function(e,t){O((function(n){var r=n.delete(s);r.onerror=t,r.onsuccess=e}))}});var x=function(e,t){return"<div class=\"gjs-templates-card\" data-id=\"".concat(e,"\">\n      ").concat(t,"\n    </div>")},w=function(e){return"<div class=\"gjs-templates-card-2\">\n      ".concat(e,"\n    </div>")},h=function(e){return"<div id=\"templates\" class=\"gjs-templates gjs-one-bg gjs-two-color\">\n      <div class=\"gjs-templates-overlay\"></div>\n      <div class=\"gjs-templates-cont\">\n        <div class=\"gjs-fonts\">\n          <label style=\"font-size: 0.9rem;font-family: Arial, Helvetica, sans-serif; display: block;\" for=\"page-name\">Name</label>\n          <div style=\"width: 50%; display: inline-block;\" class=\"gjs-field\">\n            <input style=\"border: 1px solid rgba(0, 0, 0, 0.2);\n              border-radius: 5px;\n              font-family: Arial, Helvetica, sans-serif;\" type=\"text\" name=\"pageName\" id=\"page-name\">\n          </div>\n          <span style=\"display: inline-block;\">\n            <button class=\"gjs-btn-prim\" style=\"padding: 10px;\n            border-radius: 3px;\n            font-size: 0.9rem;\n            margin-left: 220px;\" id=\"template-edit\">Edit Selected</button>\n          </span>\n          <span style=\"display: inline-block;\">\n            <button class=\"gjs-btn-prim\" style=\"padding: 10px;\n              border-radius: 3px;\n              font-size: 0.9rem;\n              margin-left: 10px;\" id=\"page-create\">Create</button>\n          </span>\n        </div>\n        <div class=\"gjs-templates-header2\">\n          Templates\n        </div>\n        ".concat(e,"\n      </div>\n    </div>")},S=function(e){return"<div id=\"pages\" class=\"gjs-templates gjs-one-bg gjs-two-color\">\n    <div class=\"gjs-templates-overlay\"></div>\n    <div class=\"gjs-templates-cont\">\n      <div class=\"gjs-templates-header2\">\n        Your Pages\n      </div>\n      ".concat(e,"\n      </div>\n    </div>")},P=function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n='';return e.forEach((function(e){var r="<svg xmlns=\"http://www.w3.org/2000/svg\" class=\"template-preview\" viewBox=\"0 0 1300 1100\" width=\"99%\" height=\"220\">\n        <foreignObject width=\"100%\" height=\"100%\" style=\"pointer-events:none\">\n          <div xmlns=\"http://www.w3.org/1999/xhtml\" ".concat(e[v()+'html']?'':'padding-top:100%',"\">\n          ").concat(e[v()+'html']+'<style scoped>'+e[v()+'css']+'</style>',"\n          </div>\n        </foreignObject>\n      </svg>"),o="".concat(r,"\n      <div class=\"label\">").concat(e.id,"</div>");t?e.template&&(n+=x(e.id,o)):!e.template&&(n+=x(e.id,o))})),t?h(w(n)):S(w(n))};u.add('open-templates',{run:function(e,t){var n=document.querySelector('.gjs-mdl-dialog');n.classList.add("gjs-mdl-dialog-tml"),t&&t.set&&t.set('active'),p.setTitle('<div style="font-size: 1rem">Create Page</div>'),e.Storage.get('indexeddb').loadAll((function(t){p.setContent(P(t)),l('.gjs-templates-card').forEach((function(e){return e.dataset.id==i&&e.classList.add('gjs-templates-card-active')})),l('#page-name')[0].addEventListener('keyup',(function(e){return a=e.currentTarget.value})),l('#page-create')[0].addEventListener('click',(function(t){s=i,d=!1,a&&e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),s=a,p.close()}))})),l('#template-edit')[0].addEventListener('click',(function(t){s=i,d=!0,e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),p.close()}))})),l('.gjs-templates-card').forEach((function(e){e.addEventListener('click',(function(t){i=t.currentTarget.dataset.id,l('.gjs-templates-card').forEach((function(e){return e.classList.remove('gjs-templates-card-active')})),e.classList.add('gjs-templates-card-active')}))}))}),(function(e){return console.log("Error",e)})),p.open(),p.getModel().once('change:open',(function(){document.querySelector('.gjs-mdl-collector').innerHTML="",n.classList.remove("gjs-mdl-dialog-tml")}))}}),u.add('open-pages',{run:function(e,t){var n=document.querySelector('.gjs-mdl-dialog');n.classList.add("gjs-mdl-dialog-tml"),t&&t.set&&t&&t.set('active'),p.setTitle('<div style="font-size: 1rem">Select Page</div>'),e.Storage.get('indexeddb').loadAll((function(t){p.setContent(P(t,!1)),l('.gjs-templates-card').forEach((function(e){return e.dataset.id==s&&e.classList.add('gjs-templates-card-active')})),l('.gjs-templates-card').forEach((function(t){t.addEventListener('click',(function(t){s=t.currentTarget.dataset.id,d=!1,e.load((function(t){e.setComponents(t.components?JSON.parse(t.components):t.html),e.setStyle(t.styles?JSON.parse(t.styles):t.css),p.close()}))}))}))}),(function(e){return console.log("Error",e)})),p.open(),p.getModel().once('change:open',(function(){document.querySelector('.gjs-mdl-collector').innerHTML="",n.classList.remove("gjs-mdl-dialog-tml")}))}}),u.add('save-as-template',{run:function(e,t){d=!0,e.store()}}),u.add('delete-from-idb',{run:function(e,t){e.Storage.get('indexeddb').delete((function(e){return console.log(e)}),(function(e){return console.log(e)})),e.Commands.run('open-pages')}})}},function(e,t){e.exports=function(e,t){if(null==e)return{};var n,r,o={},s=Object.keys(e);for(r=0;r<s.length;r++)n=s[r],t.indexOf(n)>=0||(o[n]=e[n]);return o}}])}));
